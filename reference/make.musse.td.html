<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Multiple State Speciation and Extinction Model: Time Dependent Models — make.musse.td • diversitree</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Multiple State Speciation and Extinction Model: Time Dependent Models — make.musse.td"><meta property="og:description" content="Create a likelihood function for a MuSSE model where
  different chunks of time have different parameters.  This code is
  experimental!"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">diversitree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.10-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Multiple State Speciation and Extinction Model: Time Dependent Models</h1>

    <div class="hidden name"><code>make.musse.td.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create a likelihood function for a MuSSE model where
  different chunks of time have different parameters.  This code is
  experimental!</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make.musse.td</span><span class="op">(</span><span class="va">tree</span>, <span class="va">states</span>, <span class="va">k</span>, <span class="va">n.epoch</span>, sampling.f<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>              strict<span class="op">=</span><span class="cn">TRUE</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">make.musse.t</span><span class="op">(</span><span class="va">tree</span>, <span class="va">states</span>, <span class="va">k</span>, <span class="va">functions</span>, sampling.f<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>             strict<span class="op">=</span><span class="cn">TRUE</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, truncate<span class="op">=</span><span class="cn">FALSE</span>, spline.data<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-tree">tree<a class="anchor" aria-label="anchor" href="#arg-tree"></a></dt>
<dd><p>An ultrametric bifurcating phylogenetic tree, in
    <code>ape</code> “phylo” format.</p></dd>


  <dt id="arg-states">states<a class="anchor" aria-label="anchor" href="#arg-states"></a></dt>
<dd><p>A vector of character states, each of which must be an
    integer between 1 and <code>k</code>.  This vector must have names that
    correspond to the tip labels in the phylogenetic tree
    (<code>tree$tip.label</code>).  For tips corresponding to unresolved
    clades, the state should be <code>NA</code>.</p></dd>


  <dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>The number of states.</p></dd>


  <dt id="arg-n-epoch">n.epoch<a class="anchor" aria-label="anchor" href="#arg-n-epoch"></a></dt>
<dd><p>Number of epochs.  1 corresponds to plain MuSSE, so
    this will generally be an integer at least 2.</p></dd>


  <dt id="arg-functions">functions<a class="anchor" aria-label="anchor" href="#arg-functions"></a></dt>
<dd><p>A named list of functions of time.  See details.</p></dd>


  <dt id="arg-sampling-f">sampling.f<a class="anchor" aria-label="anchor" href="#arg-sampling-f"></a></dt>
<dd><p>Vector of length <code>k</code> where <code>sampling.f[i]</code>
    is the proportion of species in state <code>i</code> that are present in
    the phylogeny.  A value of <code>c(0.5, 0.75, 1)</code> means that half of
    species in state 1, three quarters of species in state 2, and all
    species in state 3 are included in the phylogeny.  By default all
    species are assumed to be known</p></dd>


  <dt id="arg-strict">strict<a class="anchor" aria-label="anchor" href="#arg-strict"></a></dt>
<dd><p>The <code>states</code> vector is always checked to make sure
    that the values are integers on <code>1:k</code>.  If <code>strict</code> is
    <code>TRUE</code> (the default), then the additional check is made that
    <em>every</em> state is present.  The likelihood models tend to be
    poorly behaved where states are missing, but there are cases
    (missing intermediate states for meristic characters) where allowing
    such models may be useful.</p></dd>


  <dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>List of control parameters for the ODE solver.  See
    details in <code><a href="make.bisse.html">make.bisse</a></code>.</p></dd>


  <dt id="arg-truncate">truncate<a class="anchor" aria-label="anchor" href="#arg-truncate"></a></dt>
<dd><p>Logical, indicating if functions should be truncated
    to zero when negative (rather than causing an error).  May be
    scalar (applying to all functions) or a vector (of same length as
    the functions vector).</p></dd>


  <dt id="arg-spline-data">spline.data<a class="anchor" aria-label="anchor" href="#arg-spline-data"></a></dt>
<dd><p>List of data for spline-based time functions.  See
    details</p></dd>
</dl><p>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Please see <code><a href="make.bisse.td.html">make.bisse.t</a></code> for further details.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Richard G. FitzJohn</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Here we will start with the tree and three-state character set from</span></span></span>
<span class="r-in"><span><span class="co">## the make.musse example.  This is a poorly contrived example.</span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>,  <span class="fl">.15</span>,  <span class="fl">.2</span>,  <span class="co"># lambda 1, 2, 3</span></span></span>
<span class="r-in"><span>          <span class="fl">.03</span>, <span class="fl">.045</span>, <span class="fl">.06</span>, <span class="co"># mu 1, 2, 3</span></span></span>
<span class="r-in"><span>          <span class="fl">.05</span>, <span class="fl">0</span>,         <span class="co"># q12, q13</span></span></span>
<span class="r-in"><span>          <span class="fl">.05</span>, <span class="fl">.05</span>,       <span class="co"># q21, q23</span></span></span>
<span class="r-in"><span>          <span class="fl">0</span>,   <span class="fl">.05</span><span class="op">)</span>       <span class="co"># q31, q32</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate.html">tree.musse</a></span><span class="op">(</span><span class="va">pars</span>, <span class="fl">30</span>, x0<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Suppose we want to see if diversification is different in the most</span></span></span>
<span class="r-in"><span><span class="co">## recent 3 time units, compared with the rest of the tree (yes, this is</span></span></span>
<span class="r-in"><span><span class="co">## a totally contrived example!):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phy</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">axisPhylo</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu">branching.times</span><span class="op">(</span><span class="va">phy</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="make.musse.td-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## For comparison, make a plain MuSSE likelihood function</span></span></span>
<span class="r-in"><span><span class="va">lik.m</span> <span class="op">&lt;-</span> <span class="fu"><a href="make.musse.html">make.musse</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create the time-dependent likelihood function.  The final argument</span></span></span>
<span class="r-in"><span><span class="co">## here is the number of 'epochs' that are allowed.  Two epochs is one</span></span></span>
<span class="r-in"><span><span class="co">## switch point.</span></span></span>
<span class="r-in"><span><span class="va">lik.t</span> <span class="op">&lt;-</span> <span class="fu">make.musse.td</span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The switch point is the first argument.  The remaining 12 parameters</span></span></span>
<span class="r-in"><span><span class="co">## are the MuSSE parameters, with the first 6 being the most recent</span></span></span>
<span class="r-in"><span><span class="co">## epoch.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.t</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "t.1"       "lambda1.1" "lambda2.1" "lambda3.1" "mu1.1"     "mu2.1"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "mu3.1"     "q12.1"     "q13.1"     "q21.1"     "q23.1"     "q31.1"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "q32.1"     "lambda1.2" "lambda2.2" "lambda3.2" "mu1.2"     "mu2.2"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "mu3.2"     "q12.2"     "q13.2"     "q21.2"     "q23.2"     "q31.2"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "q32.2"    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pars.t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">pars</span>, <span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pars.t</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.t</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculations are identical to a reasonable tolerance:</span></span></span>
<span class="r-in"><span><span class="fu">lik.m</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span> <span class="op">-</span> <span class="fu">lik.t</span><span class="op">(</span><span class="va">pars.t</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2.505392e-08</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## It will often be useful to constrain the time as a fixed quantity.</span></span></span>
<span class="r-in"><span><span class="va">lik.t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="constrain.html">constrain</a></span><span class="op">(</span><span class="va">lik.t</span>, <span class="va">t.1</span> <span class="op">~</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Parameter estimation under maximum likelihood.  This is marked "don't</span></span></span>
<span class="r-in"><span><span class="co">## run" because the time-dependent fit takes a few minutes.</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">## Fit the MuSSE ML model</span></span></span>
<span class="r-in"><span><span class="va">fit.m</span> <span class="op">&lt;-</span> <span class="fu"><a href="find.mle.html">find.mle</a></span><span class="op">(</span><span class="va">lik.m</span>, <span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## And fit the MuSSE/td model</span></span></span>
<span class="r-in"><span><span class="va">fit.t</span> <span class="op">&lt;-</span> <span class="fu"><a href="find.mle.html">find.mle</a></span><span class="op">(</span><span class="va">lik.t2</span>, <span class="va">pars.t</span><span class="op">[</span><span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.t2</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                  control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">20000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Compare these two fits with a likelihood ratio test (lik.t2 is nested</span></span></span>
<span class="r-in"><span><span class="co">## within lik.m)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fit.m</span>, td<span class="op">=</span><span class="va">fit.t</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Richard G. FitzJohn, Emma Goldberg, Karen Magnuson-Ford, Roger Sidje.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

