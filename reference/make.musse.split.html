<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Multiple State Speciation and Extinction Model: Split Models — make.musse.split • diversitree</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Multiple State Speciation and Extinction Model: Split Models — make.musse.split"><meta property="og:description" content="Create a likelihood function for a MuSSE model where the
  tree is partitioned into regions with different parameters."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">diversitree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9-23</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Multiple State Speciation and Extinction Model: Split Models</h1>

    <div class="hidden name"><code>make.musse.split.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create a likelihood function for a MuSSE model where the
  tree is partitioned into regions with different parameters.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make.musse.split</span><span class="op">(</span><span class="va">tree</span>, <span class="va">states</span>, <span class="va">k</span>, <span class="va">nodes</span>, <span class="va">split.t</span>,</span>
<span>                 sampling.f<span class="op">=</span><span class="cn">NULL</span>, strict<span class="op">=</span><span class="cn">TRUE</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-tree">tree<a class="anchor" aria-label="anchor" href="#arg-tree"></a></dt>
<dd><p>An ultrametric bifurcating phylogenetic tree, in
    <code>ape</code> “phylo” format.</p></dd>


  <dt id="arg-states">states<a class="anchor" aria-label="anchor" href="#arg-states"></a></dt>
<dd><p>A vector of character states, each of which must be an
    integer between 1 and <code>k</code>.  This vector must have names that
    correspond to the tip labels in the phylogenetic tree
    (<code>tree$tip.label</code>).  For tips corresponding to unresolved
    clades, the state should be <code>NA</code>.</p></dd>


  <dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>The number of states.</p></dd>


  <dt id="arg-nodes">nodes<a class="anchor" aria-label="anchor" href="#arg-nodes"></a></dt>
<dd><p>Vector of nodes that will be split (see Details).</p></dd>


  <dt id="arg-split-t">split.t<a class="anchor" aria-label="anchor" href="#arg-split-t"></a></dt>
<dd><p>Vector of split times, same length as <code>nodes</code> (see
    Details).</p></dd>


  <dt id="arg-sampling-f">sampling.f<a class="anchor" aria-label="anchor" href="#arg-sampling-f"></a></dt>
<dd><p>Vector of length <code>k</code> where <code>sampling.f[i]</code>
    is the proportion of species in state <code>i</code> that are present in
    the phylogeny.  A value of <code>c(0.5, 0.75, 1)</code> means that half of
    species in state 1, three quarters of species in state 2, and all
    species in state 3 are included in the phylogeny.  By default all
    species are assumed to be known</p></dd>


  <dt id="arg-strict">strict<a class="anchor" aria-label="anchor" href="#arg-strict"></a></dt>
<dd><p>The <code>states</code> vector is always checked to make sure
    that the values are integers on <code>1:k</code>.  If <code>strict</code> is
    <code>TRUE</code> (the default), then the additional check is made that
    <em>every</em> state is present.  The likelihood models tend to be
    poorly behaved where states are missing, but there are cases
    (missing intermediate states for meristic characters) where allowing
    such models may be useful.</p></dd>


  <dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>List of control parameters for the ODE solver.  See
    details in <code><a href="make.bisse.html">make.bisse</a></code>.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Branching times can be controlled with the <code>split.t</code>
argument.  If this is <code>Inf</code>, split at the base of the branch (as in
MEDUSA).  If <code>0</code>, split at the top (closest to the present, as in
the new option for MEDUSA).  If <code>0 &lt; split.t &lt; Inf</code> then we split
at that time on the tree (zero is the present, with time growing
backwards).</p>
<p><!-- % TODO: Describe \code{nodes} and \code{split.t} here. --></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Richard G. FitzJohn</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## This example picks up from the tree used in the ?make.musse example.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## First, simulate the tree:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>,  <span class="fl">.15</span>,  <span class="fl">.2</span>,  <span class="co"># lambda 1, 2, 3</span></span></span>
<span class="r-in"><span>          <span class="fl">.03</span>, <span class="fl">.045</span>, <span class="fl">.06</span>, <span class="co"># mu 1, 2, 3</span></span></span>
<span class="r-in"><span>          <span class="fl">.05</span>, <span class="fl">0</span>,         <span class="co"># q12, q13</span></span></span>
<span class="r-in"><span>          <span class="fl">.05</span>, <span class="fl">.05</span>,       <span class="co"># q21, q23</span></span></span>
<span class="r-in"><span>          <span class="fl">0</span>,   <span class="fl">.05</span><span class="op">)</span>       <span class="co"># q31, q32</span></span></span>
<span class="r-in"><span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate.html">tree.musse</a></span><span class="op">(</span><span class="va">pars</span>, <span class="fl">30</span>, x0<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Here is the phylogeny, with true character history superposed:</span></span></span>
<span class="r-in"><span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="history.from.sim.html">history.from.sim.discrete</a></span><span class="op">(</span><span class="va">phy</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">h</span>, <span class="va">phy</span>, show.node.label<span class="op">=</span><span class="cn">TRUE</span>, font<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">.75</span>, no.margin<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Here is a plain MuSSE function for later comparison:</span></span></span>
<span class="r-in"><span><span class="va">lik.m</span> <span class="op">&lt;-</span> <span class="fu"><a href="make.musse.html">make.musse</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lik.m</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span> <span class="co"># -110.8364</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -110.8364</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Split this phylogeny at three points: nd16 and nd25, splitting it</span></span></span>
<span class="r-in"><span><span class="co">## into three chunks</span></span></span>
<span class="r-in"><span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nd16"</span>, <span class="st">"nd25"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">nodelabels</span><span class="op">(</span>node<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">phy</span><span class="op">$</span><span class="va">node.label</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">phy</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           pch<span class="op">=</span><span class="fl">19</span>, cex<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"#FF000099"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="make.musse.split-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To make a split BiSSE function, pass the node locations and times</span></span></span>
<span class="r-in"><span><span class="co">## in.  Here, we'll use 'Inf' as the split time to mimick MEDUSA's</span></span></span>
<span class="r-in"><span><span class="co">## behaviour of placing the split at the base of the branch subtended by</span></span></span>
<span class="r-in"><span><span class="co">## a node.</span></span></span>
<span class="r-in"><span><span class="va">lik.s</span> <span class="op">&lt;-</span> <span class="fu">make.musse.split</span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>, <span class="fl">3</span>, <span class="va">nodes</span>, split.t<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The parameters must be a list of the same length as the number of</span></span></span>
<span class="r-in"><span><span class="co">## partitions.  Partition '1' is the root partition, and partition i is</span></span></span>
<span class="r-in"><span><span class="co">## the partition rooted at the node[i-1]:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.s</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "lambda1.1" "lambda2.1" "lambda3.1" "mu1.1"     "mu2.1"     "mu3.1"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "q12.1"     "q13.1"     "q21.1"     "q23.1"     "q31.1"     "q32.1"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "lambda1.2" "lambda2.2" "lambda3.2" "mu1.2"     "mu2.2"     "mu3.2"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "q12.2"     "q13.2"     "q21.2"     "q23.2"     "q31.2"     "q32.2"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "lambda1.3" "lambda2.3" "lambda3.3" "mu1.3"     "mu2.3"     "mu3.3"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] "q12.3"     "q13.3"     "q21.3"     "q23.3"     "q31.3"     "q32.3"    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Because we have two nodes, there are three sets of parameters.</span></span></span>
<span class="r-in"><span><span class="co">## Replicate the original list to get a starting point for the analysis:</span></span></span>
<span class="r-in"><span><span class="va">pars.s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">pars</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pars.s</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.s</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">lik.s</span><span class="op">(</span><span class="va">pars.s</span><span class="op">)</span> <span class="co"># -110.8364</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -110.8364</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This is basically identical (to acceptable tolerance) to the plain</span></span></span>
<span class="r-in"><span><span class="co">## MuSSE version:</span></span></span>
<span class="r-in"><span><span class="fu">lik.s</span><span class="op">(</span><span class="va">pars.s</span><span class="op">)</span> <span class="op">-</span> <span class="fu">lik.m</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1.982002e-09</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The resulting likelihood function can be used in ML analyses with</span></span></span>
<span class="r-in"><span><span class="co">## find.mle.  However, because of the large number of parameters, this</span></span></span>
<span class="r-in"><span><span class="co">## may take some time (especially with as few species as there are in</span></span></span>
<span class="r-in"><span><span class="co">## this tree - getting convergence in a reasonable number of iterations</span></span></span>
<span class="r-in"><span><span class="co">## is difficult).</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">fit.s</span> <span class="op">&lt;-</span> <span class="fu"><a href="find.mle.html">find.mle</a></span><span class="op">(</span><span class="va">lik.s</span>, <span class="va">pars.s</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">20000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Bayesian analysis also works, using the mcmc function.  Given the</span></span></span>
<span class="r-in"><span><span class="co">## large number of parameters, priors will be essential, as there will</span></span></span>
<span class="r-in"><span><span class="co">## be no signal for several parameters.  Here, I am using an exponential</span></span></span>
<span class="r-in"><span><span class="co">## distribution with a mean of twice the state-independent</span></span></span>
<span class="r-in"><span><span class="co">## diversification rate.</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="make.prior.html">make.prior.exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="make.bd.html">starting.point.bd</a></span><span class="op">(</span><span class="va">phy</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">lik.s</span>, <span class="va">pars.s</span>, <span class="fl">100</span>, prior<span class="op">=</span><span class="va">prior</span>, w<span class="op">=</span><span class="fl">1</span>, print.every<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Richard G. FitzJohn, Emma Goldberg, Karen Magnuson-Ford, Roger Sidje.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

