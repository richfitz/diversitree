<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Quantitative State Speciation and Extinction Model — make.quasse • diversitree</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Quantitative State Speciation and Extinction Model — make.quasse"><meta property="og:description" content="Prepare to run QuaSSE (Quantitative State Speciation and
  Extinction) on a phylogenetic tree and character distribution.  This
  function creates a likelihood function that can be used in
  maximum likelihood or Bayesian
  inference."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">diversitree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9-19</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quantitative State Speciation and Extinction Model</h1>
    
    <div class="hidden name"><code>make.quasse.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Prepare to run QuaSSE (Quantitative State Speciation and
  Extinction) on a phylogenetic tree and character distribution.  This
  function creates a likelihood function that can be used in
  <a href="find.mle.html">maximum likelihood</a> or <a href="mcmc.html">Bayesian</a>
  inference.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make.quasse</span><span class="op">(</span><span class="va">tree</span>, <span class="va">states</span>, <span class="va">states.sd</span>, <span class="va">lambda</span>, <span class="va">mu</span>, <span class="va">control</span>,</span>
<span>            sampling.f<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu">starting.point.quasse</span><span class="op">(</span><span class="va">tree</span>, <span class="va">states</span>, states.sd<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>tree</dt>
<dd><p>An ultrametric bifurcating phylogenetic tree, in
    <code>ape</code> “phylo” format.</p></dd>

  
  <dt>states</dt>
<dd><p>A vector of character states, each of which must be a
    numeric real values.  Missing values (<code>NA</code>) are not yet handled.
    This vector must have names that correspond to the tip labels in the
    phylogenetic tree  (<code>tree$tip.label</code>).</p></dd>


  <dt>states.sd</dt>
<dd><p>A scalar or vector corresponding to the standard
    error around the mean in states (the initial probability
    distribution is assumed to be normal).</p></dd>


  <dt>lambda</dt>
<dd><p>A function to use as the speciation function.  The first
    argument of this must be <code>x</code> (see Details).</p></dd>


  <dt>mu</dt>
<dd><p>A function to use as the extinction function.  The first
    argument of this must be <code>x</code> (see Details.)</p></dd>


  <dt>control</dt>
<dd><p>A list of parameters for tuning the performance of the
    integrator.  A guess at reasonble values will be made here.  See
    Details for possible entries.</p></dd>


  <dt>sampling.f</dt>
<dd><p>Scalar with the estimated proportion of extant
    species that are included in the phylogeny.  A value of <code>0.75</code>
    means that three quarters of extant species are included in the
    phylogeny.  By default all species are assumed to be known.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The <code>control</code> list may contain the following elements:</p>
<p></p><ul><li><p><code>method</code>: one of <code>fftC</code> or <code>fftR</code> to switch
    between <code>C</code> (fast) and <span style="R">R</span> (slow) backends for the integration.
    Both use non-adaptive fft-based convolutions.  Eventually, an
    adaptive methods-of-lines approach will be available.</p></li>
<li><p><code>dt.max</code>: Maximum time step to use for the integration.
    By default, this will be set to 1/1000 of the tree depth.  Smaller
    values will slow down calculations, but improve accuracy.</p></li>
<li><p><code>nx</code>: The number of bins into which the character space
    is divided (default=1024).  Larger values will be slower and more
    accurate.  For the <code>fftC</code> integration method, this should be an
    integer power of 2 (512, 2048, etc).</p></li>
<li><p><code>r</code>: Scaling factor that multiplies <code>nx</code> for a "high
    resolution" section at the tips of the tree (default=4, giving a
    high resolution character space divided into 4096 bins).  This helps
    improve accuracy while possibly tight initial probability
    distributions flatten out as time progresses towards the root.
    Larger values will be slower and more accurate.  For the <code>fftC</code>
    integration method, this should be a power of 2 (2, 4, 8, so that
    <code>nx*r</code> is a power of 2).</p></li>
<li><p><code>tc</code>: where in the tree to switch to the low-resolution
    integration (zero corresponds to the present, larger numbers moving
    towards the root).  By default, this happens at 10% of the tree
    depth.  Smaller values will be faster, but less accurate.</p></li>
<li><p><code>xmid</code>: Mid point to center the character space.  By
    default this is at the mid point of the extremes of the character
    states.</p></li>
<li><p><code>tips.combined</code>: Get a modest speed-up by simultaneously
    integrating all tips?  By default, this is <code>FALSE</code>, but
    speedups of up to 25% are possible with this set to <code>TRUE</code>.</p></li>
<li><p><code>w</code>: Number of standard deviations of the normal
    distribution induced by Brownian motion to use when doing the
    convolutions (default=5).  Probably best to leave this one alone.</p></li>
</ul></div>
    <div id="warning">
    <h2>Warning</h2>
    <p>In an attempt at being computationally efficient, a substantial amount
  of information is cached in memory so that it does not have to be
  created each time.  However, this can interact poorly with the
  <code>multicore</code> package.  In particular, likelihood functions should
  not be made within a call to <code>mclapply</code>, or they will not share
  memory with the main <span style="R">R</span> thread, and will not work (this will cause an
  error, but should no longer crash <span style="R">R</span>).</p>
<p>The method has less general testing than BiSSE, and is a little more
  fragile.  In particular, because of the way that I chose to implement
  the integrator, there is a very real chance of likelihood calculation
  failure when your data are a poor fit to the model; this can be
  annoyingly difficult to diagnose (you will just get a <code>-Inf</code> log
  likelihood, but the problem is often just caused by two sister species
  on short branches with quite different states).  There are also a
  large number of options for fine tuning the integration, but these
  aren't really discussed in any great detail anywhere.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Richard G. FitzJohn</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Due to a change in sample() behaviour in newer R it is necessary to</span></span></span>
<span class="r-in"><span><span class="co">## use an older algorithm to replicate the previous examples</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html" class="external-link">getRversion</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="st">"3.6.0"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">RNGkind</a></span><span class="op">(</span>sample.kind <span class="op">=</span> <span class="st">"Rounding"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>non-uniform 'Rounding' sampler used</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example showing simple integration with two different backends,</span></span></span>
<span class="r-in"><span><span class="co">## plus the splits.</span></span></span>
<span class="r-in"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="quasse-common.html">sigmoid.x</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>,  <span class="fl">0</span>, <span class="fl">2.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="quasse-common.html">constant.x</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.03</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">char</span> <span class="op">&lt;-</span> <span class="fu"><a href="quasse-common.html">make.brownian.with.drift</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.025</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate.html">tree.quasse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lambda</span>, <span class="va">mu</span>, <span class="va">char</span><span class="op">)</span>, max.taxa<span class="op">=</span><span class="fl">15</span>, x0<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span>                   single.lineage<span class="op">=</span><span class="cn">FALSE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 3 [1.012]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 4 [1.584]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 5 [3.616]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 6 [6.170]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -: 5 [6.201]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 6 [6.927]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 7 [7.912]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 8 [9.209]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 9 [9.463]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 10 [9.823]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -: 9 [10.944]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 10 [11.295]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 11 [11.620]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 12 [11.715]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 13 [12.604]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 14 [12.883]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 15 [13.473]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +: 16 [13.773]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nd13"</span>, <span class="st">"nd9"</span>, <span class="st">"nd5"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">split.t</span> <span class="op">&lt;-</span> <span class="cn">Inf</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">.03</span>, <span class="fl">0</span>, <span class="fl">.01</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pars4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">200</span></span></span>
<span class="r-in"><span><span class="va">control.C.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dt.max<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">200</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">control.R.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dt.max<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">200</span>, method<span class="op">=</span><span class="st">"fftR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lik.C.1</span> <span class="op">&lt;-</span> <span class="fu">make.quasse</span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>, <span class="va">sd</span>, <span class="va">sigmoid.x</span>, <span class="va">constant.x</span>, <span class="va">control.C.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">ll.C.1</span> <span class="op">&lt;-</span> <span class="fu">lik.C.1</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span><span class="op">)</span> <span class="co"># -62.06409</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## slow...</span></span></span>
<span class="r-in"><span><span class="va">lik.R.1</span> <span class="op">&lt;-</span> <span class="fu">make.quasse</span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>, <span class="va">sd</span>, <span class="va">sigmoid.x</span>, <span class="va">constant.x</span>, <span class="va">control.R.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">ll.R.1</span> <span class="op">&lt;-</span> <span class="fu">lik.R.1</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span><span class="op">)</span> <span class="co"># -62.06409</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">lik.s.C.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="make.quasse.split.html">make.quasse.split</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>, <span class="va">sd</span>, <span class="va">sigmoid.x</span>, <span class="va">constant.x</span>,</span></span>
<span class="r-in"><span>                               <span class="va">nodes</span>, <span class="va">split.t</span>, <span class="va">control.C.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">ll.s.C.1</span> <span class="op">&lt;-</span> <span class="fu">lik.s.C.1</span><span class="op">(</span><span class="va">pars4</span><span class="op">)</span><span class="op">)</span> <span class="co"># -62.06409</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Richard G. FitzJohn, Emma Goldberg, Karen Magnuson-Ford, Roger Sidje.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

