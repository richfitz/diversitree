<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Binary State Speciation and Extinction Model: Time Dependant
  Models — make.bisse.td • diversitree</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Binary State Speciation and Extinction Model: Time Dependant
  Models — make.bisse.td"><meta property="og:description" content="Create a likelihood function for a BiSSE model where
  different chunks of time have different parameters.  This code is
  experimental!"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">diversitree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9-18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Binary State Speciation and Extinction Model: Time Dependant
  Models</h1>
    
    <div class="hidden name"><code>make.bisse.td.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create a likelihood function for a BiSSE model where
  different chunks of time have different parameters.  This code is
  experimental!</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make.bisse.td</span><span class="op">(</span><span class="va">tree</span>, <span class="va">states</span>, <span class="va">n.epoch</span>, unresolved<span class="op">=</span><span class="cn">NULL</span>, sampling.f<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>              nt.extra<span class="op">=</span><span class="fl">10</span>, strict<span class="op">=</span><span class="cn">TRUE</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">make.bisse.t</span><span class="op">(</span><span class="va">tree</span>, <span class="va">states</span>, <span class="va">functions</span>, unresolved<span class="op">=</span><span class="cn">NULL</span>, sampling.f<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>             strict<span class="op">=</span><span class="cn">TRUE</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, truncate<span class="op">=</span><span class="cn">FALSE</span>, spline.data<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>tree</dt>
<dd><p>An ultrametric bifurcating phylogenetic tree, in
    <code>ape</code> “phylo” format.</p></dd>

  
  <dt>states</dt>
<dd><p>A vector of character states, each of which must be 0 or
    1, or <code>NA</code> if the state is unknown.  This vector must have
    names that correspond to the tip labels in the phylogenetic tree
    (<code>tree$tip.label</code>).  For tips
    corresponding to unresolved clades, the state should be <code>NA</code>.</p></dd>

  
  <dt>n.epoch</dt>
<dd><p>Number of epochs.  1 corresponds to plain BiSSE, so
    this will generally be an integer at least 2.</p></dd>


  <dt>functions</dt>
<dd><p>A named character vector of functions of time.  See
    details.</p></dd>

  
  <dt>unresolved</dt>
<dd><p>Unresolved clade information: see
    <code><a href="make.bisse.html">make.bisse</a></code>. (Currently this is not supported.)</p></dd>

  
  <dt>sampling.f</dt>
<dd><p>Vector of length 2 with the estimated proportion of
    extant species in state 0 and 1 that are included in the phylogeny.
    See <code><a href="make.bisse.html">make.bisse</a></code>.</p></dd>

  
  <dt>nt.extra</dt>
<dd><p>The number of species modelled in unresolved clades
    (this is in addition to the largest observed clade).</p></dd>


  <dt>strict</dt>
<dd><p>The <code>states</code> vector is always checked to make sure
    that the values are 0 and 1 only.  If <code>strict</code> is <code>TRUE</code>
    (the default), then the additional check is made that <em>every</em>
    state is present.  The likelihood models tend to be poorly behaved
    where states are missing.</p></dd>

  
  <dt>control</dt>
<dd><p>List of control parameters for the ODE solver.  See
    details in <code><a href="make.bisse.html">make.bisse</a></code>.</p></dd>


  <dt>truncate</dt>
<dd><p>Logical, indicating if functions should be truncated
    to zero when negative (rather than causing an error).  May be
    scalar (applying to all functions) or a vector (of length 6).</p></dd>


  <dt>spline.data</dt>
<dd><p>List of data for spline-based time functions.  See
    details</p></dd>
</dl><p>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This builds a BiSSE likelihood function where different regions of
  time (epochs) have different parameter sets.  By default, all
  parameters are free to vary between epochs, so some constraining will
  probably be required to get reasonable answers.</p>
<p>For <code>n</code> epochs, there are <code>n-1</code> time points; the first
  <code>n-1</code> elements of the likelihood's parameter vector are these
  points.  These are measured from the present at time zero, with time
  increasing towards the base of the tree.  The rest of the parameter
  vector are BiSSE parameters; the elements <code>n:(n+6)</code> are for the
  first epoch (closest to the present), elements <code>(n+7):(n+13)</code> are
  for the second epoch, and so on.</p>  
<p>For <code>make.bisse.t</code>, the <code>funtions</code> is a vector of names of
  functions of time.
  For example, to have speciation rates be linear functions of
  time, while the extinction and character change rates be constant with
  respect to time, one can do</p><div class="sourceCode"><pre><code><span><span class="va">functions</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"linear.t"</span>, <span class="st">"constant.t"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p>The functions here must have <code>t</code> as their first argument,
  interpreted as time back from the present.  Other possible functions
  are "sigmoid.t", "stepf.t", "spline.t", "exp.t", and "spline.linear.t".
  Unfortunately, documentation is still pending.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Richard G. FitzJohn</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Due to a change in sample() behaviour in newer R it is necessary to</span></span></span>
<span class="r-in"><span><span class="co">## use an older algorithm to replicate the previous examples</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html" class="external-link">getRversion</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="st">"3.6.0"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">RNGkind</a></span><span class="op">(</span>sample.kind <span class="op">=</span> <span class="st">"Rounding"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>non-uniform 'Rounding' sampler used</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.03</span>, <span class="fl">0.03</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate.html">tree.bisse</a></span><span class="op">(</span><span class="va">pars</span>, max.t<span class="op">=</span><span class="fl">30</span>, x0<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Suppose we want to see if diversification is different in the most</span></span></span>
<span class="r-in"><span><span class="co">## recent 3 time units, compared with the rest of the tree (yes, this is</span></span></span>
<span class="r-in"><span><span class="co">## a totally contrived example!):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phy</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">axisPhylo</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu">branching.times</span><span class="op">(</span><span class="va">phy</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="make.bisse.td-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## For comparison, make a plain BiSSE likelihood function</span></span></span>
<span class="r-in"><span><span class="va">lik.b</span> <span class="op">&lt;-</span> <span class="fu"><a href="make.bisse.html">make.bisse</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create the time-dependent likelihood function.  The final argument</span></span></span>
<span class="r-in"><span><span class="co">## here is the number of 'epochs' that are allowed.  Two epochs is one</span></span></span>
<span class="r-in"><span><span class="co">## switch point.</span></span></span>
<span class="r-in"><span><span class="va">lik.t</span> <span class="op">&lt;-</span> <span class="fu">make.bisse.td</span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The switch point is the first argument.  The remaining 12 parameters</span></span></span>
<span class="r-in"><span><span class="co">## are the BiSSE parameters, with the first 6 being the most recent</span></span></span>
<span class="r-in"><span><span class="co">## epoch.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.t</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "t.1"       "lambda0.1" "lambda1.1" "mu0.1"     "mu1.1"     "q01.1"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "q10.1"     "lambda0.2" "lambda1.2" "mu0.2"     "mu1.2"     "q01.2"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "q10.2"    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pars.t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">pars</span>, <span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pars.t</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.t</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculations are identical to a reasonable tolerance:</span></span></span>
<span class="r-in"><span><span class="fu">lik.b</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span> <span class="op">-</span> <span class="fu">lik.t</span><span class="op">(</span><span class="va">pars.t</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -2.052648e-07</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## It will often be useful to constrain the time as a fixed quantity.</span></span></span>
<span class="r-in"><span><span class="va">lik.t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="constrain.html">constrain</a></span><span class="op">(</span><span class="va">lik.t</span>, <span class="va">t.1</span> <span class="op">~</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Parameter estimation under maximum likelihood.  This is marked "don't</span></span></span>
<span class="r-in"><span><span class="co">## run" because the time-dependent fit takes a few minutes.</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## Fit the BiSSE ML model</span></span></span>
<span class="r-in"><span><span class="va">fit.b</span> <span class="op">&lt;-</span> <span class="fu"><a href="find.mle.html">find.mle</a></span><span class="op">(</span><span class="va">lik.b</span>, <span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## And fit the BiSSE/td model</span></span></span>
<span class="r-in"><span><span class="va">fit.t</span> <span class="op">&lt;-</span> <span class="fu"><a href="find.mle.html">find.mle</a></span><span class="op">(</span><span class="va">lik.t2</span>, <span class="va">pars.t</span><span class="op">[</span><span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.t2</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                  control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">20000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Compare these two fits with a likelihood ratio test (lik.t2 is nested</span></span></span>
<span class="r-in"><span><span class="co">## within lik.b)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fit.b</span>, td<span class="op">=</span><span class="va">fit.t</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The time varying model (bisse.t)  is more general, but substantially</span></span></span>
<span class="r-in"><span><span class="co">## slower.  Here, I will show that the two functions are equivalent for</span></span></span>
<span class="r-in"><span><span class="co">## step function models.  We'll constrain all the non-lambda parameters</span></span></span>
<span class="r-in"><span><span class="co">## to be the same over a time-switch at t=5.  This leaves 8 parameters.</span></span></span>
<span class="r-in"><span><span class="va">lik.td</span> <span class="op">&lt;-</span> <span class="fu">make.bisse.td</span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lik.td2</span> <span class="op">&lt;-</span> <span class="fu"><a href="constrain.html">constrain</a></span><span class="op">(</span><span class="va">lik.td</span>, <span class="va">t.1</span> <span class="op">~</span> <span class="fl">5</span>,          </span></span>
<span class="r-in"><span>                     <span class="va">mu0.2</span> <span class="op">~</span> <span class="va">mu0.1</span>, <span class="va">mu1.2</span> <span class="op">~</span> <span class="va">mu1.1</span>,</span></span>
<span class="r-in"><span>                     <span class="va">q01.2</span> <span class="op">~</span> <span class="va">q01.1</span>, <span class="va">q10.2</span> <span class="op">~</span> <span class="va">q10.1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">lik.t</span> <span class="op">&lt;-</span> <span class="fu">make.bisse.t</span><span class="op">(</span><span class="va">phy</span>, <span class="va">phy</span><span class="op">$</span><span class="va">tip.state</span>,</span></span>
<span class="r-in"><span>                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stepf.t"</span>, <span class="st">"constant.t"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lik.t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="constrain.html">constrain</a></span><span class="op">(</span><span class="va">lik.t</span>, <span class="va">lambda0.tc</span> <span class="op">~</span> <span class="fl">5</span>, <span class="va">lambda1.tc</span> <span class="op">~</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Note that the argument names for these functions are different from</span></span></span>
<span class="r-in"><span><span class="co">## one another.  This reflects different ways that the functions will</span></span></span>
<span class="r-in"><span><span class="co">## tend to be used, but is potentially confusing here.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.td2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "lambda0.1" "lambda1.1" "mu0.1"     "mu1.1"     "q01.1"     "q10.1"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7] "lambda0.2" "lambda1.2"</span>
<span class="r-in"><span><span class="fu"><a href="argnames.html">argnames</a></span><span class="op">(</span><span class="va">lik.t2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "lambda0.y0" "lambda0.y1" "lambda1.y0" "lambda1.y1" "mu0"       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "mu1"        "q01"        "q10"       </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## First, evaluate the functions with no time effect and check that they</span></span></span>
<span class="r-in"><span><span class="co">## are the same as the base BiSSE model</span></span></span>
<span class="r-in"><span><span class="va">p.td</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p.t</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## All agree:</span></span></span>
<span class="r-in"><span><span class="fu">lik.b</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span>   <span class="co"># -159.7128</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -159.71</span>
<span class="r-in"><span><span class="fu">lik.td2</span><span class="op">(</span><span class="va">p.td</span><span class="op">)</span> <span class="co"># -159.7128</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -159.71</span>
<span class="r-in"><span><span class="fu">lik.t2</span><span class="op">(</span><span class="va">p.t</span><span class="op">)</span>   <span class="co"># -159.7128</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -159.71</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## In fact, the time-varying BiSSE will tend to be identical to plain</span></span></span>
<span class="r-in"><span><span class="co">## BiSSE where the functions to not change:</span></span></span>
<span class="r-in"><span><span class="fu">lik.b</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span> <span class="op">-</span> <span class="fu">lik.t2</span><span class="op">(</span><span class="va">p.t</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Slight numerical differences are typical for the time-chunk BiSSE,</span></span></span>
<span class="r-in"><span><span class="co">## because it forces the integration to be carried out more carefully</span></span></span>
<span class="r-in"><span><span class="co">## around the switch point.</span></span></span>
<span class="r-in"><span><span class="fu">lik.b</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span> <span class="op">-</span> <span class="fu">lik.td2</span><span class="op">(</span><span class="va">p.td</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -2.52191e-07</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Next, evaluate the functions with a time effect (5 time units ago,</span></span></span>
<span class="r-in"><span><span class="co">## speciation rates were twice the contemporary rate)</span></span></span>
<span class="r-in"><span><span class="va">p.td2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p.t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Huge drop in the likelihood (from -159.7128 to -172.7874)</span></span></span>
<span class="r-in"><span><span class="fu">lik.b</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -159.71</span>
<span class="r-in"><span><span class="fu">lik.td2</span><span class="op">(</span><span class="va">p.td2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -172.7696</span>
<span class="r-in"><span><span class="fu">lik.t2</span><span class="op">(</span><span class="va">p.t2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -172.7696</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The small difference remains between the two approaches, but they are</span></span></span>
<span class="r-in"><span><span class="co">## basically the same.</span></span></span>
<span class="r-in"><span><span class="fu">lik.td2</span><span class="op">(</span><span class="va">p.td2</span><span class="op">)</span> <span class="op">-</span> <span class="fu">lik.t2</span><span class="op">(</span><span class="va">p.t2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.564434e-05</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## There is a small time cost to both time-dependent methods, </span></span></span>
<span class="r-in"><span><span class="co">## heavily paid for the time-chunk case:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">lik.b</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.003   0.000   0.003 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">lik.td2</span><span class="op">(</span><span class="va">p.td</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 1.9x slower than plain BiSSE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.004   0.000   0.004 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">lik.td2</span><span class="op">(</span><span class="va">p.td2</span><span class="op">)</span><span class="op">)</span> <span class="co"># 1.9x slower than plain BiSSE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.005   0.000   0.005 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">lik.t2</span><span class="op">(</span><span class="va">p.t</span><span class="op">)</span><span class="op">)</span>    <span class="co"># about the same speed</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.004   0.000   0.004 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">lik.t2</span><span class="op">(</span><span class="va">p.t2</span><span class="op">)</span><span class="op">)</span>   <span class="co"># about the same speed</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.004   0.000   0.004 </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Richard G. FitzJohn, Emma Goldberg, Karen Magnuson-Ford, Roger Sidje.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

